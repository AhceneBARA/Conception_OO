---
title: Managing Python Packages
subtitle: Concepts, Tooling, History, and Recommandations
theme: laas
author: Guilhem Saurel
date: 09/12/2019
mainfont: Source Serif 4
monofont: Source Code Pro
---

# This presentation

## Available at

- [`https://gitlab.laas.fr/gsaurel/talks :
managing-python-packages.md`](https://gitlab.laas.fr/gsaurel/talks/-/blob/main/managing-python-packages.md)
- [`https://homepages.laas.fr/gsaurel/talks/
managing-python-packages.pdf`](https://homepageslaas.fr/gsaurel/talks/managing-python-packages.pdf)

## Under License

\centering

![CC](docs/cc.png){width=1cm}
![BY](docs/by.png){width=1cm}
![SA](docs/sa.png){width=1cm}

<https://creativecommons.org/licenses/by-sa/4.0/>

# Modules

- `toto.py`
- `toto.so`
- `toto/__init__.py`

. . .

```python
>>> import toto
```

# Packages

```
toto/
├── __init__.py
├── robot.py
├── settings.py
├── simulation.py
└── user_interface.py
```

. . .

```python
>>> import toto.user_interface
```

# Packages

```
toto/
├── __init__.py
├── robot.py
├── sensors/
│   ├── camera.py
│   ├── imu.py
│   └── __init__.py
├── settings.py
├── simulation.py
└── user_interface.py
```

. . .

```python
>>> import toto.sensors.imu
```

# Imports

## don't

```python
>>> from settings import ROBOT_SIZE
```

. . .

## do

```python
>>> from toto.settings import ROBOT_SIZE
# or
>>> from .settings import ROBOT_SIZE
```

# Imports (continued)

## don't

```python
>>> from .robot import *
```

. . .

## do

```python
>>> from .robot import start, stop, turn, jump
# or
>>> import .robot as rb
```

# `sys.path`

```python
In [1]: import sys

In [2]: sys.path
Out[2]:
['/usr/lib/python38.zip',
 '/usr/lib/python3.8',
 '/usr/lib/python3.8/lib-dynload',
 '',
 '/usr/local/lib/python3.8/dist-packages',
 '/usr/lib/python3/dist-packages']
```

. . .

[https://docs.python.org/3/library/site](https://docs.python.org/3/library/site):

`sys.prefix + 'lib/pythonX.Y/site-packages'`

# OS package managers

```bash
$ sudo apt install python3-numpy
$ dpkg -L python3-numpy
…
/usr/lib/python3/dist-packages/numpy/__init__.py
…
```

. . .

- Works out of the box
- Intended package for:
    - your system's other applications
    - any other user of your system

# pip

## don't

```bash
$ sudo pip install --upgrade numpy
…
Installing collected packages: numpy
  Attempting uninstall: numpy
    Found existing installation: numpy 1.17.4
    Not uninstalling numpy at /usr/lib/python3/dist-packages, outside environment /usr
    Can't uninstall 'numpy'. No files were found to uninstall.
Successfully installed numpy-1.21.2
```

```python
>>> import numpy
>>> numpy.__version__
'1.21.2'
>>> numpy.__file__
'/usr/local/lib/python3.8/dist-packages/numpy/…
```

# pip

## do

```bash
$ python -m pip install --user --upgrade numpy
…
Installing collected packages: numpy
Successfully installed numpy-1.21.2
```

```python
>>> import numpy
>>> numpy.__version__
'1.21.2'
>>> numpy.__file__
/home/user/.local/lib/python3.8/site-packages/…
```

# requirements.txt

```bash
$ cat requirements.txt
numpy>=1.16
ipython
quadprog==0.1.7
requests
tqdm
```

`python -m pip install --user -r requirements.txt`

# pip-tools

```bash
$ cat requirements.in
django<3
$ python -m pip install --user pip-tools
$ pip-compile
```

# pip-tools (continued)

```bash
$ cat requirements.txt
#
# This file is autogenerated by pip-compile with python 3.8
# To update, run:
#
#    pip-compile
#
django==2.2.24
    # via -r requirements.in
pytz==2021.3
    # via django
sqlparse==0.4.2
    # via django
```

# Managing paths

```bash
$ Z="lib/python3.8/site-packages"
$ export PYTHONPATH=/opt/openrobots/${Z}
$ # or
$ echo /opt/openrobots/${Z} > ~/.local/${Z}/my.pth
```

# virtualenv


`$ python -m venv ~/project/my_v_env`

. . .

```
~/project/my_v_env/
├── bin/
│   ├── activate
│   ├── pip
│   └── python -> /usr/bin/python3
├── include/
├── lib/
│   └── python3.8/
│       └── site-packages/
│           ├── pip/
│           └── setuptools/
└── pyvenv.cfg
```

# virtualenv

```bash
$ . ~/project/my_v_env/bin/activate
(my_v_env) $ which python
/home/user/project/my_v_env/bin/python
```

```python
In [1]: import sys

In [2]: sys.path
Out[2]:
['/home/user/project/my_v_env/bin',
 '/usr/lib/python38.zip',
 '/usr/lib/python3.8',
 '/usr/lib/python3.8/lib-dynload',
 '',
 '/home/user/project/my_v_env/lib/python3.8/site-packages',
 '/home/user/project/my_v_env/lib/python3.8/site-packages/IPython/extensions',
 '/home/user/.ipython']
```

# virtualenvwrapper

- `mkvirtualenv`
- `mktmpenv`
- `workon`
- `deactivate`
- `.venv` file

. . .

virtualfish

# Pipenv

> Python Development Workflow for Humans

\hfill --- Kenneth Reitz

- pip w/ version pinning
- virtualenv w/ wrapper

# Poetry

- pip w/ version pinning (like Pipenv)
- virtualenv w/ wrapper (like Pipenv)
- with replacement for `setup.py` (packaging)
- with replacement for `setup.cfg` (tooling configuration)
- with better handling of versions
- without Kenneth Reitz

# Anaconda

> The World's Most Popular Data Science Platform

\hfill --- <https://www.anaconda.com/>

- a separate package format
- a separate package repository (condaforge)
- a separate package manager (conda)
- with commercial support

# My recommandations

1. `python -m pip install --user --upgrade some-pkg`

. . .

2. `python -m venv venv`

. . .

3. poetry
