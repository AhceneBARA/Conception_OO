---
title: Managing Python Packages
institute: LAAS-CNRS
titlegraphic: documents/LogoLAAS-2016.png
author: Guilhem Saurel
date: 09/12/2019
mainfont: Source Serif Pro
monofont: Source Code Pro
---

# This presentation

## Available at

[`http://laas.fr/~gsaurel/talks/
managing-python-packages.pdf`](http://laas.fr/~gsaurel/talks/managing-python-packages.pdf)

## Under License

\hfill ![CC](documents/cc.xlarge.png){width=1cm}
\hfill ![BY](documents/by.xlarge.png){width=1cm}
\hfill ![SA](documents/sa.xlarge.png){width=1cm}
\hfill
\hfill

<https://creativecommons.org/licenses/by-sa/4.0/>

# Modules

- `toto.py`
- `toto.so`
- `toto/__init__.py`

. . .

```python
>>> import toto
```

# Packages

```
toto/
├── __init__.py
├── robot.py
├── settings.py
├── simulation.py
└── user_interface.py
```

. . .

```python
>>> import toto.user_interface
```

# Packages

```
toto/
├── __init__.py
├── robot.py
├── sensors/
│   ├── camera.py
│   ├── imu.py
│   └── __init__.py
├── settings.py
├── simulation.py
└── user_interface.py
```

. . .

```python
>>> import toto.sensors.imu
```

# Imports

## don't

```python
>>> from settings import ROBOT_SIZE
```

. . .

## do

```python
>>> from toto.settings import ROBOT_SIZE
# or
>>> from .settings import ROBOT_SIZE
```

. . .

## don't

```python
>>> from .robot import *
```

. . .

## do

```python
>>> from .robot import start, stop, turn, jump
# or
>>> import .robot as rb
```

# `sys.path`

```python
In [1]: import sys

In [2]: sys.path
Out[2]:
['',
 '/usr/lib/python36.zip',
 '/usr/lib/python3.6',
 '/usr/lib/python3.6/lib-dynload',
 '/usr/local/lib/python3.6/dist-packages',
 '/usr/lib/python3/dist-packages',
 '/usr/lib/python3/dist-packages/IPython/ext…',
 '/root/.ipython']
```

. . .

[https://docs.python.org/3/library/site](https://docs.python.org/3/library/site):

`sys.prefix + 'lib/pythonX.Y/site-packages'`

# OS package managers

```bash
$ sudo apt install python3-numpy
$ dpkg -L python3-numpy
…
/usr/lib/python3/dist-packages/numpy/__init__.py
…
```

. . .

- Works out of the box
- Intended package for:
    - your system's other applications
    - any other user of your system

# pip

## don't

```bash
$ sudo pip3 install --upgrade numpy
…
Installing collected packages: numpy
  Found existing installation: numpy 1.13.3
    Not uninstalling numpy at
    /usr/lib/python3/dist-packages,
    outside environment /usr
Successfully installed numpy-1.17.4
```

```python
>>> import numpy
>>> numpy.__version__
'1.17.4'
>>> numpy.__file__
'/usr/local/lib/python3.6/dist-packages/numpy/…
```

# pip

## do

```bash
$ pip3 install --user --upgrade numpy
…
Installing collected packages: numpy
Successfully installed numpy-1.17.4
```

```python
>>> import numpy
>>> numpy.__version__
'1.17.4'
>>> numpy.__file__
/home/user/.local/lib/python3.6/site-packages/…
```

# Upgrade pip

## don't

```bash
$ pip3 install --user --upgrade pip
…
Installing collected packages: pip
Successfully installed pip-19.3.1
$ pip3 --version
File "/usr/bin/pip3", line 9, in <module>
    from pip import main
ImportError: cannot import name 'main'
```

# Upgrade pip

## do

```bash
$ python3 -m pip --version
pip 19.3.1 from
/home/user/.local/lib/python3.6/site-packages/…
(python 3.6)
```

. . .

- `<prefix>/bin/pip3`
- `<sys.path>/pip/__main__.py`

pip is included in Python >= 2.7.4 / >= 3.4

but on Debian / Ubuntu: `sudo apt install python3-pip`

# requirements.txt

```bash
$ cat requirements.txt
numpy>=1.16
ipython
quadprog==0.1.7
requests
tqdm
```

`pip install --user -r requirements.txt`

# pip-tools

```bash
$ cat requirements.in
django<3
$ pip install --user pip-tools
$ pip-compile
$ cat requirements.txt
#
# This file is autogenerated by pip-compile
# To update, run:
#
#    pip-compile
#
django==2.2.8
pytz==2019.3              # via django
sqlparse==0.3.0           # via django
```

# Managing paths

```bash
$ Z="lib/python3.6/site-packages"
$ export PYTHONPATH=/opt/openrobots/${Z}
$ # or
$ echo /opt/openrobots/${Z} > ~/.local/${Z}/my.pth
```

# virtualenv

venv is included in Python >= 3.3

but on Debian / Ubuntu: `sudo apt install python3-venv`

`$ python3 -m venv ~/project/my_v_env`

. . .

```
~/project/my_v_env/
├── bin/
│   ├── activate
│   ├── pip
│   └── python -> /usr/bin/python3
├── include/
├── lib/
│   └── python3.6/
│       └── site-packages/
│           ├── pip/
│           └── setuptools/
└── pyvenv.cfg
```

# virtualenv

```bash
$ . ~/project/my_v_env/bin/activate
(my_v_env) $ which python
/home/user/project/my_v_env/bin/python
```

```python
In [1]: import sys

In [2]: sys.path
Out[2]:
['/home/user/project/my_v_env/bin',
 '/usr/lib/python36.zip',
 '/usr/lib/python3.6',
 '/usr/lib/python3.6/lib-dynload',
 '',
 '/home/user/project/my_v_env/lib/python3.6/site-packages',
 '/home/user/project/my_v_env/lib/python3.6/site-packages/IPython/extensions',
 '/home/user/.ipython']
```

# virtualenvwrapper

- `mkvirtualenv`
- `mktmpenv`
- `workon`
- `deactivate`
- `.venv` file

. . .

virtualfish

# Pipenv

> Python Development Workflow for Humans

\hfill --- Kenneth Reitz

- pip w/ version pinning
- virtualenv w/ wrapper

. . .

Demo !

# Poetry

- pip w/ version pinning (like Pipenv)
- virtualenv w/ wrapper (like Pipenv)
- with replacement for `setup.py` (packaging)
- with replacement for `setup.cfg` (tooling configuration)
- with better handling of versions
- without Kenneth Reitz

# Anaconda

> The World's Most Popular Data Science Platform

\hfill --- <https://www.anaconda.com/>

- Any project who must say "I am the World's Most Popular" is no true "World's Most Popular"

This is a bloated commercial product with:

- a separate package format
- a separate package repository (condaforge)
- a separate package manager (conda)
- without stating any technical advantage
- but with commercial support

# My recommandations

- for now, use Pipenv
- Poetry seems better, but:
    - `curl … | python` prefered installation method is not nice
    - `v1.0` is still in beta
    - toml is better, but not available in Python Standard Library
    - other projects are not yet ready to get all benefits:
      <https://gitlab.com/pycqa/flake8/issues/428>
      <https://github.com/google/yapf/issues/708>
- avoid Ananconda. Yes, this works, but makes no sense other than being a commercial product, especially if you work on
  only on Linux and with C/C++ & Python.
